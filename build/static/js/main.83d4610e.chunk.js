(this.webpackJsonpemma=this.webpackJsonpemma||[]).push([[0],{41:function(e,t,n){},42:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),s=n(22),i=n.n(s),o=n(11),c=n(12),l=n(14),u=n(13),m=n(44),f=n(46),h=n(45),p=n.p+"static/media/cpr.csv.24831468.gz",d=n.p+"static/media/SOCAT.csv.c5d052c4.gz",y=n(23),j=n.n(y),O=n(0),b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function x(e){var t=e.match(/^(\d\d)\/(\d\d)\/(\d\d\d\d)( (\d\d):(\d\d))?$/),n=t?new Date(t[3],t[2]-1,t[1],t[4]&&t[5]||0,t[4]&&t[6]||0,0):null;return n&&n.getFullYear()?n:null}var S=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={},e.data={},e.monthTimer=function(t){var n=e.state.m;e.timer&&clearTimeout(e.timer),t||11===n?e.setState({m:0,y:null}):e.setState({m:n+1,y:null}),e.timer=setTimeout(e.monthTimer,11===n?3e3:1e3)},e.yearTimer=function(t){var n=e.state.y,r=e.state.socat,a=Object.keys(r.ps);e.timer&&clearTimeout(e.timer),t||n===a[a.length-1]?e.setState({y:a[0],m:null}):e.setState({y:a[a.indexOf(n)+1],m:null}),e.timer=setTimeout(e.yearTimer,n===a[a.length-1]?3e3:1e3)},e.animate=function(t){var n=["Animate","ABUN by month","ABUN by year","CO2 by month","SSS by month","SST by month"].indexOf(t);e.timer&&clearTimeout(e.timer),e.timer=null,0===n||-1===n?e.setState({a:null,y:null,m:null,f:null}):e.setState({a:t,f:n<3?"ABUN":t.substr(0,3)}),1===n?e.monthTimer(!0):2===n?e.yearTimer(!0):n>2&&e.monthTimer(!0)},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;[{data:p,name:"cpr",cols:{x:"Latitude",y:"Longitude",date:"Midpoint_Date_Local",ABUN:"195"},date:x,errors:20},{data:d,name:"SOCAT",cols:{x:"LAT",y:"LON",date:"DATE",CO2:"FCO2_AVE_WEIGHTED",SSS:"SALINITY_AVE_WEIGHTED",SST:"SST_AVE_WEIGHTED"},filter:{SSS:{min:26,max:40},CO2:{min:200,max:500},date:{min:1993,max:2019},x:{min:30,max:80},y:{min:-75,max:26}},date:x,errors:500}].forEach((function(t){return e.load_data(t).then((function(t){e.data[t.name]=t,t.errors.length&&console.log(t.name,"errors",t.errors),console.log(t.name,{lines:t.lines,filtered:t.filter,d:t}),"SOCAT"===t.name?e.setState({socat:t}):e.setState({cpr:t})})).catch((function(e){console.error(e.name,"too many errors",e.errors)}))}))}},{key:"load_data",value:function(e){return new Promise((function(t,n){fetch(e.data).then((function(e){return e.arrayBuffer()})).then((function(r){var a=j.a.inflate(r,{to:"string"}).split(/\r\n|\n/).map((function(e){return e.replace(/"([^,]*), ([^,]*)"/,"$2 $1").replace(/"/g,"").split(",")})),s=a[0].map((function(e){return e.trim()})),i={name:e.name,l:{},ps:{},ys:{},n:[],errors:[],lines:0,filter:0},o=function(){var t=a[i.lines],n={},r=Object.keys(e.cols);for(c=0;c<r.length;c++){var o=r[c];t[s.indexOf(e.cols[o])]?n[o]="date"===o?e.date(t[s.indexOf(e.cols[o])]):1*t[s.indexOf(e.cols[o])]:(n.error=!0,n.error||i.errors.push({e:"1",file:e.name,line:i.lines,k:o})),n[o]||0===n[o]||n.error||(n.error=!0,i.errors.push({e:"2",file:e.name,line:i.lines,k:o}))}if(n.error||(n.x||0===n.x)&&(n.y||0===n.y)&&n.date||(n.error=!0,i.errors.push({e:"3",file:e.name,line:i.lines,x:n.x,y:n.y})),!n.error&&e.filter&&Object.keys(e.filter).forEach((function(t){var r={line:i.lines};"date"===t?!n.filter&&(n.date.getFullYear()<e.filter.date.min||n.date.getFullYear()>e.filter.date.max)&&(n.filter=!0,r[t]=n[t].toString(),i.filter++):!n.filter&&(n[t]<e.filter[t].min||n[t]>e.filter[t].max)&&(n.filter=!0,r[t]=n[t],i.filter++)})),!n.error&&!n.filter){var l=n.date.getFullYear(),u=n.date.getMonth(),m=Math.round(1e4*n.x)+n.y;i.ps[l]||(i.ps[l]={}),i.ps[l][u]||(i.ps[l][u]={}),i.ps[l][u][m]?i.errors.push({e:"dupe",file:e.name,line:i.lines,x:n.x,y:n.y}):(i.ps[l][u][m]=n,["x","y","CO2","SSS","SST","ABUN"].forEach((function(e){void 0===i.l[e]?i.l[e]={min:n[e],max:n[e]}:-1e34===n[e]||(n[e]<i.l[e].min?i.l[e].min=n[e]:n[e]>i.l[e].max&&(i.l[e].max=n[e]))})))}};for(i.lines=1;i.lines<a.length&&i.errors.length<e.errors;i.lines++){var c;o()}i.errors.length<e.errors?t(i):n(i)}))}))}},{key:"totals",value:function(e){var t={};return Object.keys(e.ys).forEach((function(n){Object.keys(e.ys[n]).forEach((function(r){var a=0,s=0;e.ys[n][r].forEach((function(t){e.ps[t][n].forEach((function(r){s+=1/e.ps[t][n].length,a+=r.n/e.ps[t][n].length}))})),t[n]||(t[n]={}),t[n][r]||(t[n][r]={}),t[n][r]={n:s,t:a}}))})),t}},{key:"render",value:function(){var e=this,t=this.state.socat;if(!t)return Object(O.jsx)("div",{children:"loading data ..."});var n=this.state.y,r=this.state.y2,s=Object.keys(t.ps),i=this.state.m,o=this.state.m2,c=this.state.f,l=this.state.cpr;return Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{children:[Object(O.jsx)(g,{ks:["ABUN by month","ABUN by year","CO2 by month","SSS by month","SST by month"],k:this.state.a,set:this.animate,name:"Animate"}),this.state.a?Object(O.jsx)("button",{onClick:function(){return e.animate("stop")},children:"Stop"}):Object(O.jsxs)(a.a.Fragment,{children:[Object(O.jsx)(g,{ks:["CO2","SSS","SST","ABUN"],k:this.state.f,set:function(t){return e.setState({f:t})},name:"Field"}),Object(O.jsx)(g,{ks:s,k:n,set:function(t){return e.setState({y:t})},name:"Year"}),Object(O.jsx)(g,{ks:s,k:r,set:function(t){return e.setState({y2:t})},name:"...Year"}),Object(O.jsx)(g,{ks:b,k:b[i],set:function(t){return e.setState({m:t&&b.indexOf(t)})},name:"Month"}),Object(O.jsx)(g,{ks:b,k:b[o],set:function(t){return e.setState({m2:t&&b.indexOf(t)})},name:"...Month"})]}),Object(O.jsxs)("span",{children:[" ",n,r?"-"+r:null," ",b[i],o?"-"+b[o]:null]})]}),t&&Object(O.jsxs)(m.a,{bounds:[[t.l.x.min,t.l.y.min],[t.l.x.max,t.l.y.max]],children:[Object(O.jsx)(f.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),c?Object(O.jsx)(v,{data:"ABUN"===c?l:t,m:i,y:n,y2:r,m2:o,f:c,a:this.state.a}):null]})]})}}]),n}(r.Component),v=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.y,t=this.props.m,n=this.props.y2,r=this.props.m2,a=this.props.f,s=this.props.data,i=Object.keys(s.ps),o=this.props.a,c=[];return i.forEach((function(i){(!e||i===e||n&&i<=n&&i>e)&&b.forEach((function(e){var n=b.indexOf(e);if(!t&&0!==t||n===t||r&&n>t&&n<=r){var l=function(e){var t=e.i||0,n=[],r=e.y,a=e.m,s=e.f,i=e.d,o=r&&(a||0===a)&&i.ps[r]&&i.ps[r][a]&&Object.keys(i.ps[r][a]);o&&o.forEach((function(e){var o=i.ps[r][a][e],c=i.l,l=(o[s]-c[s].min)/(c[s].max-c[s].min),u=o[s]&&"#00"+(255-Math.round(255*l)).toString(16)+"00";-1e34!==o[s]&&n.push({key:t++,center:[o.x,o.y],radius:1,color:u})}));return n}({i:c.length,y:i,m:n,f:a,d:s});c=c.concat(l),o||console.log(i,e,l.length)}}))})),c.length?c.map((function(e){return Object(O.jsx)(h.a,{center:e.center,radius:e.radius,color:e.color},e.key)})):null}}]),n}(r.Component);var g=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).set=function(t){t.preventDefault(),e.props.set(t.target.value)},e}return Object(c.a)(n,[{key:"render",value:function(){var e=[Object(O.jsx)("option",{value:"",children:this.props.name},"")];return this.props.ks.forEach((function(t){e.push(Object(O.jsx)("option",{children:t},t))})),Object(O.jsx)("span",{children:Object(O.jsx)("select",{value:this.props.k||"",onChange:this.set,children:e})})}}]),n}(r.Component);n(41);i.a.render(Object(O.jsx)(S,{}),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.83d4610e.chunk.js.map