{"version":3,"sources":["cpr.csv.gz","SOCAT.csv.gz","Emma.js","index.js"],"names":["mnth","dd_mm_yyyy","str","m","match","d","Date","getFullYear","Emma","state","data","monthTimer","set","timer","clearTimeout","setState","a","y","setTimeout","yearTimer","socat","ys","Object","keys","ps","length","indexOf","animate","arg","cpr","name","cols","x","date","ABUN","errors","SOCAT","CO2","SSS","SST","filter","min","max","forEach","s","load_data","then","console","log","lines","filtered","catch","e","error","this","f","Promise","resolve","reject","fetch","response","arrayBuffer","csv","rows","pako","inflate","to","split","map","l","replace","head","r","trim","n","ks","i","k","push","file","line","toString","year","month","getMonth","p","Math","round","undefined","ret","c","t","y2","m2","onClick","Fragment","all","Map","bounds","TileLayer","url","attribution","Component","PYM","props","dedupe","zero","pa","yr","mn","mi","v","color","center","radius","points","cs","CircleMarker","Select","preventDefault","target","value","options","onChange","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.6620e82e.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/cpr.csv.24831468.gz\";","export default __webpack_public_path__ + \"static/media/SOCAT.csv.c5d052c4.gz\";","import React, { Component } from 'react'\r\nimport { Map, TileLayer, CircleMarker } from 'react-leaflet'\r\nimport cpr from './cpr.csv.gz'\r\nimport SOCAT from './SOCAT.csv.gz'\r\nimport pako from 'pako'\r\nconst mnth = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']\r\n\r\nfunction dd_mm_yyyy(str) {\r\n  const m = str.match(/^(\\d\\d)\\/(\\d\\d)\\/(\\d\\d\\d\\d)( (\\d\\d):(\\d\\d))?$/)\r\n  const d = m ? new Date(m[3], m[2] - 1, m[1], (m[4] && m[5]) || 0, (m[4] && m[6]) || 0, 0) : null\r\n  if (!d || !d.getFullYear()) return null\r\n  else return d\r\n}\r\n\r\nclass Emma extends Component {\r\n  state = {}\r\n  data = {}\r\n  componentDidMount() {\r\n    [\r\n      //[\"Sample_Id\", \"Latitude\", \"Longitude\", \"Midpoint_Date_Local\", \"Year\", \"Month\", \"195\", \"10508\", \"10509\", \"10510\", \"10511\", \"10512\", \"10513\", \"10514\", \"10515\"]\r\n      { data: cpr, name: 'cpr', cols: { x: 'Latitude', y: 'Longitude', date: 'Midpoint_Date_Local', ABUN: '195' }, date: dd_mm_yyyy, errors: 20 },\r\n      //[\"DATE\", \"LAT\", \"LON\", \" COUNT_NCRUISE\", \" FCO2_COUNT_NOBS\", \" FCO2_AVE_WEIGHTED\", \" FCO2_AVE_UNWTD\", \" FCO2_MIN_UNWTD\", \" FCO2_MAX_UNWTD\", \" SST_COUNT_NOBS\", \" SST_AVE_WEIGHTED\", \" SST_AVE_UNWTD\", \" SST_MIN_UNWTD\", \" SST_MAX_UNWTD\", \" SALINITY_COUNT_NOBS\", \" SALINITY_AVE_WEIGHTED\", \" SALINITY_AVE_UNWTD\", \" SALINITY_MIN_UNWTD\", \" SALINITY_MAX_UNWTD\"\r\n      { data: SOCAT, name: 'SOCAT', cols: { x: 'LAT', y: 'LON', date: 'DATE', CO2: 'FCO2_AVE_WEIGHTED', SSS: 'SALINITY_AVE_WEIGHTED', SST: 'SST_AVE_WEIGHTED' }, filter: { SSS: { min: 26, max: 40 }, CO2: { min: 200, max: 500 }, date: { min: 1993, max: 2018 }, x: { min: 30, max: 80 }, y: { min: -75, max: 26 } }, date: dd_mm_yyyy, errors: 500 }\r\n    ].forEach(s => this.load_data(s)\r\n      .then(d => {\r\n        this.data[d.name] = d\r\n        if (d.errors.length) console.log(d.name, 'errors', d.errors)\r\n        console.log(d.name, { lines: d.lines, filtered: d.filter, d })\r\n        if (d.name === 'SOCAT') this.setState({ socat: d })\r\n        else this.setState({ cpr: d })\r\n      }).catch(e => {\r\n        console.error(e.name, 'too many errors', e.errors)\r\n      }))\r\n  }\r\n  componentWillUnmount() {\r\n    this.animate('stop')\r\n  }\r\n  load_data(f) {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(f.data)\r\n        .then(function (response) {\r\n          return response.arrayBuffer()\r\n        })\r\n        .then(csv => {\r\n          let rows = pako.inflate(csv, { to: 'string' }).split(/\\r\\n|\\n/).map(l => { return l.replace(/\"([^,]*), ([^,]*)\"/, \"$2 $1\").replace(/\"/g, '').split(',') })\r\n          const head = rows[0].map(r => { return r.trim() })\r\n          const data = { name: f.name, l: {}, ps: {}, ys: {}, n: [], errors: [], lines: 0, filter: 0 }\r\n          for (data.lines = 1; data.lines < rows.length && data.errors.length < f.errors; data.lines++) {\r\n            const r = rows[data.lines]\r\n            const d = {}, ks = Object.keys(f.cols)\r\n            for (var i = 0; i < ks.length; i++) {\r\n              const k = ks[i]\r\n              if (!r[head.indexOf(f.cols[k])]) {\r\n                d.error = true\r\n                if (!d.error) data.errors.push({ e: '1', file: f.name, line: data.lines, k: k })\r\n              }\r\n              else {\r\n                if (k === 'date') d[k] = f.date(r[head.indexOf(f.cols[k])])\r\n                else d[k] = r[head.indexOf(f.cols[k])] * 1\r\n              }\r\n              if (!d[k] && d[k] !== 0 && !d.error) {\r\n                d.error = true\r\n                data.errors.push({ e: '2', file: f.name, line: data.lines, k: k })\r\n              }\r\n            }\r\n            if (!d.error && ((!d.x && d.x !== 0) || (!d.y && d.y !== 0) || !d.date)) {\r\n              d.error = true\r\n              data.errors.push({ e: '3', file: f.name, line: data.lines, x: d.x, y: d.y })\r\n            }\r\n            if (!d.error && f.filter) Object.keys(f.filter).forEach(x => {\r\n              let l = { line: data.lines }\r\n              if (x === 'date') {\r\n                if (!d.filter && (d.date.getFullYear() < f.filter.date.min || d.date.getFullYear() > f.filter.date.max)) {\r\n                  d.filter = true\r\n                  l[x] = d[x].toString()\r\n                  data.filter++ //.push(l)\r\n                }\r\n              }\r\n              else {\r\n                if (!d.filter && (d[x] < f.filter[x].min || d[x] > f.filter[x].max)) {\r\n                  d.filter = true\r\n                  l[x] = d[x]\r\n                  data.filter++ //.push(l)\r\n                }\r\n              }\r\n            })\r\n            if (!d.error && !d.filter) {\r\n              const year = d.date.getFullYear()\r\n              const month = d.date.getMonth()\r\n              const p = Math.round(d.x * 10000) + d.y\r\n              if (!data.ps[year]) data.ps[year] = {}\r\n              if (!data.ps[year][month]) data.ps[year][month] = {}\r\n              if (!data.ps[year][month][p]) {\r\n                data.ps[year][month][p] = d\r\n                  ;['x', 'y', 'CO2', 'SSS', 'SST', 'ABUN'].forEach(k => {\r\n                    if (data.l[k] === undefined) data.l[k] = { min: d[k], max: d[k] }\r\n                    else if (d[k] === -1e34) { /*skip*/ }\r\n                    else if (d[k] < data.l[k].min) data.l[k].min = d[k]\r\n                    else if (d[k] > data.l[k].max) data.l[k].max = d[k]\r\n                  })\r\n\r\n              }\r\n              else data.errors.push({ e: 'dupe', file: f.name, line: data.lines, x: d.x, y: d.y })\r\n            }\r\n          }\r\n          if (data.errors.length < f.errors) {\r\n            /* Object.keys(data.ps).forEach(p => {\r\n               const n = Object.keys(data.ps[p]).length\r\n               Object.keys(data.ps[p]).forEach(y => {\r\n                 if (!data.ys[y]) data.ys[y] = []\r\n                 if (!data.ys[y][n]) data.ys[y][n] = []\r\n                 data.ys[y][n].push(p)\r\n               })\r\n               if (!data.n[n]) data.n[n] = []\r\n               data.n[n].push(p)\r\n             })\r\n             data.t = this.totals(data)\r\n             */\r\n            resolve(data)\r\n          }\r\n          else reject(data)\r\n        })\r\n    })\r\n  }\r\n  totals(data) {\r\n    const ret = {}\r\n    Object.keys(data.ys).forEach(y => {\r\n      Object.keys(data.ys[y]).forEach(c => {\r\n        let t = 0, n = 0\r\n        data.ys[y][c].forEach(p => {\r\n          data.ps[p][y].forEach(d => {\r\n            n += 1 / data.ps[p][y].length\r\n            t += d.n / data.ps[p][y].length\r\n          })\r\n        })\r\n        if (!ret[y]) ret[y] = {}\r\n        if (!ret[y][c]) ret[y][c] = {}\r\n        ret[y][c] = { n: n, t: t }\r\n      })\r\n    })\r\n    //console.log('totals',ret)\r\n    return ret\r\n  }\r\n  monthTimer = (set) => {\r\n    const m = this.state.m\r\n    if (this.timer) clearTimeout(this.timer)\r\n    if (set) this.setState({ a: set, m: 0, y: 'all' })\r\n    else if (m === 11) this.setState({ m: 0 })\r\n    else this.setState({ m: m + 1 })\r\n    this.timer = setTimeout(this.monthTimer, m === 11 ? 3000 : 1000)\r\n  }\r\n  yearTimer = (set) => {\r\n    const y = this.state.y\r\n    const socat = this.state.socat, ys = Object.keys(socat.ps)\r\n    if (this.timer) clearTimeout(this.timer)\r\n    if (set) this.setState({ a: set, y: ys[0], m: 'all' })\r\n    else if (y === ys[ys.length - 1]) this.setState({ y: ys[0] })\r\n    else this.setState({ y: ys[ys.indexOf(y) + 1] })\r\n    this.timer = setTimeout(this.yearTimer, y === ys[ys.length - 1] ? 3000 : 1000)\r\n  }\r\n  animate = (arg) => {\r\n    const a = ['Animate', 'by month', 'by year'].indexOf(arg)\r\n    if (this.timer) clearTimeout(this.timer)\r\n    this.timer = null\r\n    if (a === 0 || a === -1) this.setState({ a: null, y: null, m: null })\r\n    else if (a === 1) this.monthTimer(arg)\r\n    else if (a === 2) this.yearTimer(arg)\r\n  }\r\n  render() {\r\n    const socat = this.state.socat\r\n    if (!socat) return <div>loading data ...</div>\r\n    const y = this.state.y, y2 = this.state.y2, ys = Object.keys(socat.ps)\r\n    const m = this.state.m, m2 = this.state.m2\r\n    const c = this.state.c, s = this.state.s, a = this.state.a\r\n    const cpr = this.state.cpr\r\n    return <div>\r\n      <div>\r\n        <Select ks={['ABUN']} k={this.state.c} set={f => this.setState({ c: f })} name=\"CPR\" />\r\n        <Select ks={['CO2', 'SSS', 'SST']} k={this.state.s} set={f => this.setState({ s: f })} name=\"SOCAT\" />\r\n        {c || s ? a === 'by year' || a === 'by month' ? <button onClick={() => this.animate('stop')}>Stop</button> :\r\n          <React.Fragment>\r\n            <span> </span>\r\n            <Select ks={['by year', 'by month']} k={a} set={this.animate} name=\"Animate\" />\r\n            <span> or </span>\r\n            <Select ks={ys} all k={y} set={y => this.setState({ y: y })} name=\"Year\" />\r\n            {y && y !== 'all' ? <Select ks={ys} k={y2} set={y => this.setState({ y2: y })} name=\"...Year\" /> : null}\r\n            <Select ks={mnth} all k={m === 'all' ? 'all' : mnth[m]} set={m => this.setState({ m: m === 'all' ? 'all' : m && mnth.indexOf(m) })} name=\"Month\" />\r\n            {(m || m === 0) && m !== 'all' ? <Select ks={mnth} k={mnth[m2]} set={m => this.setState({ m2: m && mnth.indexOf(m) })} name=\"...Month\" /> : null}\r\n          </React.Fragment> : null\r\n        }\r\n        <span> {y === 'all' ? '1993-2018' : y}{y2 ? '-' + y2 : null} {m === 12 || m === 'all' ? 'Jan-Dec' : mnth[m]}{m2 ? '-' + mnth[m2] : null}</span>\r\n      </div>\r\n      {socat && <Map bounds={[[socat.l.x.min, socat.l.y.min], [socat.l.x.max, socat.l.y.max]]}>\r\n        <TileLayer\r\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n          attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\r\n        />\r\n        {s ? <PYM data={socat} m={m} y={y} y2={y2} m2={m2} f={s} a={this.state.a} /> : null}\r\n        {c ? <PYM data={cpr} m={m} y={y} y2={y2} m2={m2} f={c} a={this.state.a} /> : null}\r\n      </Map>}\r\n    </div>\r\n  }\r\n  //      {data && <Totals data={data} />}\r\n}\r\n\r\nclass PYM extends Component {\r\n  render() {\r\n    const y = this.props.y, m = this.props.m, y2 = this.props.y2, m2 = this.props.m2, f = this.props.f, d = this.props.data,\r\n      ys = Object.keys(d.ps), a = this.props.a\r\n    //console.log('PYM', { y, y2, m, m2, f, d, l: d.l })\r\n    let ret = [], n = 0, dedupe = 0, zero = 0, pa = []\r\n    ys.forEach(yr => {\r\n      if (y === 'all' || yr === y || (y2 && yr <= y2 && yr > y)) {\r\n        mnth.forEach(mn => {\r\n          const mi = mnth.indexOf(mn)\r\n          if (m === 'all' || m === 12 || mi === m || (m2 && mi > m && mi <= m2)) {\r\n            const ps = points({ y: yr, m: mi, f, d })\r\n            if (ps.length) {\r\n              pa.push(ps)\r\n              n += ps.length\r\n            }\r\n            if (!a) console.log(yr, mn, ps.length)\r\n          }\r\n        })\r\n      }\r\n    })\r\n    if (pa.length) {\r\n      let i = 0, cs = {}\r\n      pa.forEach(ps => {\r\n        ps.forEach(p => {\r\n          if (!cs[p.center[0] * 1000 + p.center[1]]) {\r\n            if (n < 7000 || p.color) ret.push(<CircleMarker key={i++} center={p.center} radius={p.radius} color={p.color} />)\r\n            cs[p.center[0] * 1000 + p.center[1]] = true\r\n          }\r\n          else dedupe++\r\n          if (!p.color) zero++\r\n        })\r\n      })\r\n    }\r\n    console.log('PYM', { y, m, f, n, zero, dedupe })\r\n    return ret.length ? ret : null\r\n  }\r\n}\r\n\r\nfunction points(p) {\r\n  let ret = []\r\n  const y = p.y, m = p.m, f = p.f, d = p.d,\r\n    ps = y && (m || m === 0) && d.ps[y] && d.ps[y][m] && Object.keys(d.ps[y][m])\r\n  //console.log('Points', { y, m, f, d, l: d.l })\r\n  if (ps) ps.forEach(p => {\r\n    const v = d.ps[y][m][p]\r\n    const l = d.l, c = (v[f] - l[f].min) / (l[f].max - l[f].min)\r\n    const color = v[f] && (f === 'ABUN' ? v[f] && '#00' + (255 - Math.round(c * 255)).toString(16) + '00'\r\n      : '#' + (255 - Math.round(c * 255)).toString(16) + '0000')\r\n    //if (color.length !== 7) console.log(color) - 0 if v[f]===0 so just dot\r\n    if (v[f] !== -1e34) {\r\n      ret.push({ center: [v.x, v.y], radius: 1, color: color })\r\n    }\r\n  })\r\n  return ret\r\n}\r\n\r\n/*\r\nclass Totals extends Component {\r\n  render() {\r\n    const d = this.props.data, totals = this.props.data['t']\r\n    return <table>\r\n      <thead><tr><th>Years</th>\r\n        {Object.keys(d.n).reverse().map(n => {\r\n          return <th colSpan={4} key={n}>{n}</th>\r\n        })}\r\n      </tr>\r\n        <tr><th>Year</th>\r\n          {Object.keys(d.n).reverse().map(n => {\r\n            return <React.Fragment key={n}><th>n</th><th>total</th><th>μ</th><th>μ+</th></React.Fragment>\r\n          })}\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {Object.keys(totals).map(y => {\r\n          let t = 0, n = 0\r\n          return <tr key={y}><td>{y}</td>\r\n            {Object.keys(d.n).reverse().map(c => {\r\n              if (!totals[y][c]) return <React.Fragment key={c}><td></td><td></td><td></td><td></td></React.Fragment>\r\n              const dt = totals[y][c].t, dn = totals[y][c].n\r\n              t += dt\r\n              n += dn\r\n              return <React.Fragment key={c}><td>{Math.round(dn)}</td><td>{Math.round(dt)}</td><td>{Math.round(dt / dn)}</td><td>{Math.round(t / n)}</td></React.Fragment>\r\n            })}</tr>\r\n        })}\r\n      </tbody>\r\n    </table>\r\n  }\r\n}\r\n*/\r\n\r\nclass Select extends Component {\r\n  set = (e) => {\r\n    e.preventDefault()\r\n    this.props.set(e.target.value)\r\n  }\r\n  render() {\r\n    let options = [<option key={''} value=''>{this.props.name}</option>]\r\n    if (this.props.all) options.push(<option key={'all'} value='all'>All</option>)\r\n    this.props.ks.forEach(e => { options.push(<option key={e}>{e}</option>) })\r\n    return <span>\r\n      <select value={this.props.k || ''} onChange={this.set}>{options}</select>\r\n    </span>\r\n  }\r\n}\r\n\r\nexport { Emma }","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport {Emma} from './Emma';\r\nimport './index.css'\r\n\r\nReactDOM.render(\r\n  <Emma />,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}