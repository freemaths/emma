(this.webpackJsonpemma=this.webpackJsonpemma||[]).push([[0],{41:function(e,t,n){},42:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),s=n(22),i=n.n(s),l=n(11),o=n(12),c=n(14),u=n(13),m=n(44),h=n(46),f=n(45),p=n.p+"static/media/cpr.csv.24831468.gz",d=n.p+"static/media/SOCAT.csv.c5d052c4.gz",y=n(23),j=n.n(y),O=n(0),x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function b(e){var t=e.match(/^(\d\d)\/(\d\d)\/(\d\d\d\d)( (\d\d):(\d\d))?$/),n=t?new Date(t[3],t[2]-1,t[1],t[4]&&t[5]||0,t[4]&&t[6]||0,0):null;return n&&n.getFullYear()?n:null}var v=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={},e.data={},e.monthTimer=function(t){var n=e.state.m;e.timer&&clearTimeout(e.timer),t?e.setState({a:t,m:0,y:"all"}):11===n?e.setState({m:0}):e.setState({m:n+1}),e.timer=setTimeout(e.monthTimer,11===n?3e3:1e3)},e.yearTimer=function(t){var n=e.state.y,r=e.state.socat,a=Object.keys(r.ps);e.timer&&clearTimeout(e.timer),t?e.setState({a:t,y:a[0],m:"all"}):n===a[a.length-1]?e.setState({y:a[0]}):e.setState({y:a[a.indexOf(n)+1]}),e.timer=setTimeout(e.yearTimer,n===a[a.length-1]?3e3:1e3)},e.animate=function(t){var n=["Animate","by month","by year"].indexOf(t);e.timer&&clearTimeout(e.timer),e.timer=null,0===n||-1===n?e.setState({a:null,y:null,m:null}):1===n?e.monthTimer(t):2===n&&e.yearTimer(t)},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;[{data:p,name:"cpr",cols:{x:"Latitude",y:"Longitude",date:"Midpoint_Date_Local",ABUN:"195"},date:b,errors:20},{data:d,name:"SOCAT",cols:{x:"LAT",y:"LON",date:"DATE",CO2:"FCO2_AVE_WEIGHTED",SSS:"SALINITY_AVE_WEIGHTED",SST:"SST_AVE_WEIGHTED"},filter:{SSS:{min:26,max:40},CO2:{min:200,max:500},date:{min:1993,max:2018},x:{min:30,max:80},y:{min:-75,max:26}},date:b,errors:500}].forEach((function(t){return e.load_data(t).then((function(t){e.data[t.name]=t,t.errors.length&&console.log(t.name,"errors",t.errors),console.log(t.name,{lines:t.lines,filtered:t.filter,d:t}),"SOCAT"===t.name?e.setState({socat:t}):e.setState({cpr:t})})).catch((function(e){console.error(e.name,"too many errors",e.errors)}))}))}},{key:"componentWillUnmount",value:function(){this.animate("stop")}},{key:"load_data",value:function(e){return new Promise((function(t,n){fetch(e.data).then((function(e){return e.arrayBuffer()})).then((function(r){var a=j.a.inflate(r,{to:"string"}).split(/\r\n|\n/).map((function(e){return e.replace(/"([^,]*), ([^,]*)"/,"$2 $1").replace(/"/g,"").split(",")})),s=a[0].map((function(e){return e.trim()})),i={name:e.name,l:{},ps:{},ys:{},n:[],errors:[],lines:0,filter:0},l=function(){var t=a[i.lines],n={},r=Object.keys(e.cols);for(o=0;o<r.length;o++){var l=r[o];t[s.indexOf(e.cols[l])]?n[l]="date"===l?e.date(t[s.indexOf(e.cols[l])]):1*t[s.indexOf(e.cols[l])]:(n.error=!0,n.error||i.errors.push({e:"1",file:e.name,line:i.lines,k:l})),n[l]||0===n[l]||n.error||(n.error=!0,i.errors.push({e:"2",file:e.name,line:i.lines,k:l}))}if(n.error||(n.x||0===n.x)&&(n.y||0===n.y)&&n.date||(n.error=!0,i.errors.push({e:"3",file:e.name,line:i.lines,x:n.x,y:n.y})),!n.error&&e.filter&&Object.keys(e.filter).forEach((function(t){var r={line:i.lines};"date"===t?!n.filter&&(n.date.getFullYear()<e.filter.date.min||n.date.getFullYear()>e.filter.date.max)&&(n.filter=!0,r[t]=n[t].toString(),i.filter++):!n.filter&&(n[t]<e.filter[t].min||n[t]>e.filter[t].max)&&(n.filter=!0,r[t]=n[t],i.filter++)})),!n.error&&!n.filter){var c=n.date.getFullYear(),u=n.date.getMonth(),m=Math.round(1e4*n.x)+n.y;i.ps[c]||(i.ps[c]={}),i.ps[c][u]||(i.ps[c][u]={}),i.ps[c][u][m]?i.errors.push({e:"dupe",file:e.name,line:i.lines,x:n.x,y:n.y}):(i.ps[c][u][m]=n,["x","y","CO2","SSS","SST","ABUN"].forEach((function(e){void 0===i.l[e]?i.l[e]={min:n[e],max:n[e]}:-1e34===n[e]||(n[e]<i.l[e].min?i.l[e].min=n[e]:n[e]>i.l[e].max&&(i.l[e].max=n[e]))})))}};for(i.lines=1;i.lines<a.length&&i.errors.length<e.errors;i.lines++){var o;l()}i.errors.length<e.errors?t(i):n(i)}))}))}},{key:"totals",value:function(e){var t={};return Object.keys(e.ys).forEach((function(n){Object.keys(e.ys[n]).forEach((function(r){var a=0,s=0;e.ys[n][r].forEach((function(t){e.ps[t][n].forEach((function(r){s+=1/e.ps[t][n].length,a+=r.n/e.ps[t][n].length}))})),t[n]||(t[n]={}),t[n][r]||(t[n][r]={}),t[n][r]={n:s,t:a}}))})),t}},{key:"render",value:function(){var e=this,t=this.state.socat;if(!t)return Object(O.jsx)("div",{children:"loading data ..."});var n=this.state.y,r=this.state.y2,s=Object.keys(t.ps),i=this.state.m,l=this.state.m2,o=this.state.c,c=this.state.s,u=this.state.a,f=this.state.cpr;return Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{children:[Object(O.jsx)(g,{ks:["ABUN"],k:this.state.c,set:function(t){return e.setState({c:t})},name:"CPR"}),Object(O.jsx)(g,{ks:["CO2","SSS","SST"],k:this.state.s,set:function(t){return e.setState({s:t})},name:"SOCAT"}),o||c?"by year"===u||"by month"===u?Object(O.jsx)("button",{onClick:function(){return e.animate("stop")},children:"Stop"}):Object(O.jsxs)(a.a.Fragment,{children:[Object(O.jsx)("span",{children:" "}),Object(O.jsx)(g,{ks:["by year","by month"],k:u,set:this.animate,name:"Animate"}),Object(O.jsx)("span",{children:" or "}),Object(O.jsx)(g,{ks:s,all:!0,k:n,set:function(t){return e.setState({y:t})},name:"Year"}),n&&"all"!==n?Object(O.jsx)(g,{ks:s,k:r,set:function(t){return e.setState({y2:t})},name:"...Year"}):null,Object(O.jsx)(g,{ks:x,all:!0,k:"all"===i?"all":x[i],set:function(t){return e.setState({m:"all"===t?"all":t&&x.indexOf(t)})},name:"Month"}),!i&&0!==i||"all"===i?null:Object(O.jsx)(g,{ks:x,k:x[l],set:function(t){return e.setState({m2:t&&x.indexOf(t)})},name:"...Month"})]}):null,Object(O.jsxs)("span",{children:[" ","all"===n?"1993-2018":n,r?"-"+r:null," ",12===i||"all"===i?"Jan-Dec":x[i],l?"-"+x[l]:null]})]}),t&&Object(O.jsxs)(m.a,{bounds:[[t.l.x.min,t.l.y.min],[t.l.x.max,t.l.y.max]],children:[Object(O.jsx)(h.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),c?Object(O.jsx)(S,{data:t,m:i,y:n,y2:r,m2:l,f:c,a:this.state.a}):null,o?Object(O.jsx)(S,{data:f,m:i,y:n,y2:r,m2:l,f:o,a:this.state.a}):null]})]})}}]),n}(r.Component),S=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=this.props.y,t=this.props.m,n=this.props.y2,r=this.props.m2,a=this.props.f,s=this.props.data,i=Object.keys(s.ps),l=this.props.a,o=[],c=0,u=0,m=0,h=[];if(i.forEach((function(i){("all"===e||i===e||n&&i<=n&&i>e)&&x.forEach((function(e){var n=x.indexOf(e);if("all"===t||12===t||n===t||r&&n>t&&n<=r){var o=function(e){var t=[],n=e.y,r=e.m,a=e.f,s=e.d,i=n&&(r||0===r)&&s.ps[n]&&s.ps[n][r]&&Object.keys(s.ps[n][r]);i&&i.forEach((function(e){var i=s.ps[n][r][e],l=s.l,o=(i[a]-l[a].min)/(l[a].max-l[a].min),c=i[a]&&("ABUN"===a?i[a]&&"#00"+(255-Math.round(255*o)).toString(16)+"00":"#"+(255-Math.round(255*o)).toString(16)+"0000");-1e34!==i[a]&&t.push({center:[i.x,i.y],radius:1,color:c})}));return t}({y:i,m:n,f:a,d:s});o.length&&(h.push(o),c+=o.length),l||console.log(i,e,o.length)}}))})),h.length){var p=0,d={};h.forEach((function(e){e.forEach((function(e){d[1e3*e.center[0]+e.center[1]]?u++:((c<7e3||e.color)&&o.push(Object(O.jsx)(f.a,{center:e.center,radius:e.radius,color:e.color},p++)),d[1e3*e.center[0]+e.center[1]]=!0),e.color||m++}))}))}return console.log("PYM",{y:e,m:t,f:a,n:c,zero:m,dedupe:u}),o.length?o:null}}]),n}(r.Component);var g=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).set=function(t){t.preventDefault(),e.props.set(t.target.value)},e}return Object(o.a)(n,[{key:"render",value:function(){var e=[Object(O.jsx)("option",{value:"",children:this.props.name},"")];return this.props.all&&e.push(Object(O.jsx)("option",{value:"all",children:"All"},"all")),this.props.ks.forEach((function(t){e.push(Object(O.jsx)("option",{children:t},t))})),Object(O.jsx)("span",{children:Object(O.jsx)("select",{value:this.props.k||"",onChange:this.set,children:e})})}}]),n}(r.Component);n(41);i.a.render(Object(O.jsx)(v,{}),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.6620e82e.chunk.js.map