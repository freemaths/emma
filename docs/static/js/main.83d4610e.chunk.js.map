{"version":3,"sources":["cpr.csv.gz","SOCAT.csv.gz","Emma.js","index.js"],"names":["mnth","dd_mm_yyyy","str","m","match","d","Date","getFullYear","Emma","state","data","monthTimer","set","timer","clearTimeout","setState","y","setTimeout","yearTimer","socat","ys","Object","keys","ps","length","indexOf","animate","arg","a","f","substr","cpr","name","cols","x","date","ABUN","errors","SOCAT","CO2","SSS","SST","filter","min","max","forEach","s","load_data","then","console","log","lines","filtered","catch","e","error","Promise","resolve","reject","fetch","response","arrayBuffer","csv","rows","pako","inflate","to","split","map","l","replace","head","r","trim","n","ks","i","k","push","file","line","toString","year","month","getMonth","p","Math","round","undefined","ret","c","t","this","y2","m2","onClick","Fragment","Map","bounds","TileLayer","url","attribution","Component","PYM","props","yr","mn","mi","v","color","key","center","radius","points","concat","CircleMarker","Select","preventDefault","target","value","options","onChange","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.83d4610e.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/cpr.csv.24831468.gz\";","export default __webpack_public_path__ + \"static/media/SOCAT.csv.c5d052c4.gz\";","import React, { Component } from 'react'\r\nimport { Map, TileLayer, CircleMarker } from 'react-leaflet'\r\nimport cpr from './cpr.csv.gz'\r\nimport SOCAT from './SOCAT.csv.gz'\r\nimport pako from 'pako'\r\nconst mnth = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']\r\n\r\nfunction dd_mm_yyyy(str) {\r\n  const m = str.match(/^(\\d\\d)\\/(\\d\\d)\\/(\\d\\d\\d\\d)( (\\d\\d):(\\d\\d))?$/)\r\n  const d = m ? new Date(m[3], m[2] - 1, m[1], (m[4] && m[5]) || 0, (m[4] && m[6]) || 0, 0) : null\r\n  if (!d || !d.getFullYear()) return null\r\n  else return d\r\n}\r\n\r\nclass Emma extends Component {\r\n  state = {}\r\n  data = {}\r\n  componentDidMount() {\r\n    [\r\n      //[\"Sample_Id\", \"Latitude\", \"Longitude\", \"Midpoint_Date_Local\", \"Year\", \"Month\", \"195\", \"10508\", \"10509\", \"10510\", \"10511\", \"10512\", \"10513\", \"10514\", \"10515\"]\r\n      { data: cpr, name: 'cpr', cols: { x: 'Latitude', y: 'Longitude', date: 'Midpoint_Date_Local', ABUN: '195' }, date: dd_mm_yyyy, errors: 20 },\r\n      //[\"DATE\", \"LAT\", \"LON\", \" COUNT_NCRUISE\", \" FCO2_COUNT_NOBS\", \" FCO2_AVE_WEIGHTED\", \" FCO2_AVE_UNWTD\", \" FCO2_MIN_UNWTD\", \" FCO2_MAX_UNWTD\", \" SST_COUNT_NOBS\", \" SST_AVE_WEIGHTED\", \" SST_AVE_UNWTD\", \" SST_MIN_UNWTD\", \" SST_MAX_UNWTD\", \" SALINITY_COUNT_NOBS\", \" SALINITY_AVE_WEIGHTED\", \" SALINITY_AVE_UNWTD\", \" SALINITY_MIN_UNWTD\", \" SALINITY_MAX_UNWTD\"\r\n      { data: SOCAT, name: 'SOCAT', cols: { x: 'LAT', y: 'LON', date: 'DATE', CO2: 'FCO2_AVE_WEIGHTED', SSS: 'SALINITY_AVE_WEIGHTED', SST: 'SST_AVE_WEIGHTED' }, filter: { SSS: { min: 26, max: 40 }, CO2: { min: 200, max: 500 }, date: { min: 1993, max: 2019 }, x: { min: 30, max: 80 }, y: { min: -75, max: 26 } }, date: dd_mm_yyyy, errors: 500 }\r\n    ].forEach(s => this.load_data(s)\r\n      .then(d => {\r\n        this.data[d.name] = d\r\n        if (d.errors.length) console.log(d.name, 'errors', d.errors)\r\n        console.log(d.name, { lines: d.lines, filtered: d.filter, d })\r\n        if (d.name === 'SOCAT') this.setState({ socat: d })\r\n        else this.setState({ cpr: d })\r\n      }).catch(e => {\r\n        console.error(e.name, 'too many errors', e.errors)\r\n      }))\r\n  }\r\n  load_data(f) {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(f.data)\r\n        .then(function (response) {\r\n          return response.arrayBuffer()\r\n        })\r\n        .then(csv => {\r\n          let rows = pako.inflate(csv, { to: 'string' }).split(/\\r\\n|\\n/).map(l => { return l.replace(/\"([^,]*), ([^,]*)\"/, \"$2 $1\").replace(/\"/g, '').split(',') })\r\n          const head = rows[0].map(r => { return r.trim() })\r\n          const data = { name: f.name, l: {}, ps: {}, ys: {}, n: [], errors: [], lines: 0, filter: 0 }\r\n          for (data.lines = 1; data.lines < rows.length && data.errors.length < f.errors; data.lines++) {\r\n            const r = rows[data.lines]\r\n            const d = {}, ks = Object.keys(f.cols)\r\n            for (var i = 0; i < ks.length; i++) {\r\n              const k = ks[i]\r\n              if (!r[head.indexOf(f.cols[k])]) {\r\n                d.error = true\r\n                if (!d.error) data.errors.push({ e: '1', file: f.name, line: data.lines, k: k })\r\n              }\r\n              else {\r\n                if (k === 'date') d[k] = f.date(r[head.indexOf(f.cols[k])])\r\n                else d[k] = r[head.indexOf(f.cols[k])] * 1\r\n              }\r\n              if (!d[k] && d[k] !== 0 && !d.error) {\r\n                d.error = true\r\n                data.errors.push({ e: '2', file: f.name, line: data.lines, k: k })\r\n              }\r\n            }\r\n            if (!d.error && ((!d.x && d.x !== 0) || (!d.y && d.y !== 0) || !d.date)) {\r\n              d.error = true\r\n              data.errors.push({ e: '3', file: f.name, line: data.lines, x: d.x, y: d.y })\r\n            }\r\n            if (!d.error && f.filter) Object.keys(f.filter).forEach(x => {\r\n              let l = { line: data.lines }\r\n              if (x === 'date') {\r\n                if (!d.filter && (d.date.getFullYear() < f.filter.date.min || d.date.getFullYear() > f.filter.date.max)) {\r\n                  d.filter = true\r\n                  l[x] = d[x].toString()\r\n                  data.filter++ //.push(l)\r\n                }\r\n              }\r\n              else {\r\n                if (!d.filter && (d[x] < f.filter[x].min || d[x] > f.filter[x].max)) {\r\n                  d.filter = true\r\n                  l[x] = d[x]\r\n                  data.filter++ //.push(l)\r\n                }\r\n              }\r\n            })\r\n            if (!d.error && !d.filter) {\r\n              const year = d.date.getFullYear()\r\n              const month = d.date.getMonth()\r\n              const p = Math.round(d.x * 10000) + d.y\r\n              if (!data.ps[year]) data.ps[year] = {}\r\n              if (!data.ps[year][month]) data.ps[year][month] = {}\r\n              if (!data.ps[year][month][p]) {\r\n                data.ps[year][month][p] = d\r\n                  ;['x', 'y', 'CO2', 'SSS', 'SST', 'ABUN'].forEach(k => {\r\n                    if (data.l[k] === undefined) data.l[k] = { min: d[k], max: d[k] }\r\n                    else if (d[k] === -1e34) { /*skip*/ }\r\n                    else if (d[k] < data.l[k].min) data.l[k].min = d[k]\r\n                    else if (d[k] > data.l[k].max) data.l[k].max = d[k]\r\n                  })\r\n\r\n              }\r\n              else data.errors.push({ e: 'dupe', file: f.name, line: data.lines, x: d.x, y: d.y })\r\n            }\r\n          }\r\n          if (data.errors.length < f.errors) {\r\n            /* Object.keys(data.ps).forEach(p => {\r\n               const n = Object.keys(data.ps[p]).length\r\n               Object.keys(data.ps[p]).forEach(y => {\r\n                 if (!data.ys[y]) data.ys[y] = []\r\n                 if (!data.ys[y][n]) data.ys[y][n] = []\r\n                 data.ys[y][n].push(p)\r\n               })\r\n               if (!data.n[n]) data.n[n] = []\r\n               data.n[n].push(p)\r\n             })\r\n             data.t = this.totals(data)\r\n             */\r\n            resolve(data)\r\n          }\r\n          else reject(data)\r\n        })\r\n    })\r\n  }\r\n  totals(data) {\r\n    const ret = {}\r\n    Object.keys(data.ys).forEach(y => {\r\n      Object.keys(data.ys[y]).forEach(c => {\r\n        let t = 0, n = 0\r\n        data.ys[y][c].forEach(p => {\r\n          data.ps[p][y].forEach(d => {\r\n            n += 1 / data.ps[p][y].length\r\n            t += d.n / data.ps[p][y].length\r\n          })\r\n        })\r\n        if (!ret[y]) ret[y] = {}\r\n        if (!ret[y][c]) ret[y][c] = {}\r\n        ret[y][c] = { n: n, t: t }\r\n      })\r\n    })\r\n    //console.log('totals',ret)\r\n    return ret\r\n  }\r\n  monthTimer = (set) => {\r\n    const m = this.state.m\r\n    if (this.timer) clearTimeout(this.timer)\r\n    if (set || m === 11) this.setState({ m: 0, y: null })\r\n    else this.setState({ m: m + 1, y: null })\r\n    this.timer = setTimeout(this.monthTimer, m === 11 ? 3000 : 1000)\r\n  }\r\n  yearTimer = (set) => {\r\n    const y = this.state.y\r\n    const socat = this.state.socat, ys = Object.keys(socat.ps)\r\n    if (this.timer) clearTimeout(this.timer)\r\n    if (set || y === ys[ys.length - 1]) this.setState({ y: ys[0], m: null })\r\n    else this.setState({ y: ys[ys.indexOf(y) + 1], m: null })\r\n    this.timer = setTimeout(this.yearTimer, y === ys[ys.length - 1] ? 3000 : 1000)\r\n  }\r\n  animate = (arg) => {\r\n    const a = ['Animate', 'ABUN by month', 'ABUN by year', 'CO2 by month', 'SSS by month', 'SST by month'].indexOf(arg)\r\n    if (this.timer) clearTimeout(this.timer)\r\n    this.timer = null\r\n    if (a === 0 || a === -1) this.setState({ a: null, y: null, m: null, f: null })\r\n    else this.setState({ a: arg, f: a < 3 ? 'ABUN' : arg.substr(0, 3) })\r\n    if (a === 1) this.monthTimer(true)\r\n    else if (a === 2) this.yearTimer(true)\r\n    else if (a > 2) this.monthTimer(true)\r\n  }\r\n  render() {\r\n    const socat = this.state.socat\r\n    if (!socat) return <div>loading data ...</div>\r\n    const y = this.state.y, y2 = this.state.y2, ys = Object.keys(socat.ps)\r\n    const m = this.state.m, m2 = this.state.m2\r\n    const f = this.state.f\r\n    const cpr = this.state.cpr\r\n    return <div>\r\n      <div>\r\n        <Select ks={['ABUN by month', 'ABUN by year', 'CO2 by month', 'SSS by month', 'SST by month']} k={this.state.a} set={this.animate} name=\"Animate\" />\r\n        {this.state.a ? <button onClick={() => this.animate('stop')}>Stop</button> :\r\n          <React.Fragment>\r\n            <Select ks={['CO2', 'SSS', 'SST', 'ABUN']} k={this.state.f} set={f => this.setState({ f: f })} name=\"Field\" />\r\n            <Select ks={ys} k={y} set={y => this.setState({ y: y })} name=\"Year\" />\r\n            <Select ks={ys} k={y2} set={y => this.setState({ y2: y })} name=\"...Year\" />\r\n            <Select ks={mnth} k={mnth[m]} set={m => this.setState({ m: m && mnth.indexOf(m) })} name=\"Month\" />\r\n            <Select ks={mnth} k={mnth[m2]} set={m => this.setState({ m2: m && mnth.indexOf(m) })} name=\"...Month\" />\r\n          </React.Fragment>}\r\n        <span> {y}{y2 ? '-' + y2 : null} {mnth[m]}{m2 ? '-' + mnth[m2] : null}</span>\r\n      </div>\r\n      {socat && <Map bounds={[[socat.l.x.min, socat.l.y.min], [socat.l.x.max, socat.l.y.max]]}>\r\n        <TileLayer\r\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n          attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\r\n        />\r\n        {f ? <PYM data={f === 'ABUN' ? cpr : socat} m={m} y={y} y2={y2} m2={m2} f={f} a={this.state.a} /> : null}\r\n      </Map>}\r\n    </div>\r\n  }\r\n  //      {data && <Totals data={data} />}\r\n}\r\n\r\nclass PYM extends Component {\r\n  render() {\r\n    const y = this.props.y, m = this.props.m, y2 = this.props.y2, m2 = this.props.m2, f = this.props.f, d = this.props.data,\r\n      ys = Object.keys(d.ps), a = this.props.a\r\n    //console.log('PYM', { y, y2, m, m2, f, d, l: d.l })\r\n    let ret = []\r\n    ys.forEach(yr => {\r\n      if (!y || yr === y || (y2 && yr <= y2 && yr > y)) {\r\n        mnth.forEach(mn => {\r\n          const mi = mnth.indexOf(mn)\r\n          if ((!m && m !== 0) || mi === m || (m2 && mi > m && mi <= m2)) {\r\n            const ps = points({ i: ret.length, y: yr, m: mi, f, d })\r\n            ret = ret.concat(ps)\r\n            if (!a) console.log(yr, mn, ps.length)\r\n          }\r\n        })\r\n      }\r\n    })\r\n    return ret.length ? ret.map(p => <CircleMarker key={p.key} center={p.center} radius={p.radius} color={p.color} />) : null\r\n  }\r\n}\r\n\r\nfunction points(p) {\r\n  let i = p.i || 0, ret = []\r\n  const y = p.y, m = p.m, f = p.f, d = p.d,\r\n    ps = y && (m || m === 0) && d.ps[y] && d.ps[y][m] && Object.keys(d.ps[y][m])\r\n  //console.log('Points', { y, m, f, d, l: d.l })\r\n  if (ps) ps.forEach(p => {\r\n    const v = d.ps[y][m][p]\r\n    const l = d.l, c = (v[f] - l[f].min) / (l[f].max - l[f].min)\r\n    const color = v[f] && '#00' + (255 - Math.round(c * 255)).toString(16) + '00'\r\n    //if (color.length !== 7) console.log(color) - 0 if v[f]===0 so just dot\r\n    if (v[f] !== -1e34) ret.push({ key: i++, center: [v.x, v.y], radius: 1, color: color })\r\n  })\r\n  return ret\r\n}\r\n\r\n/*\r\nclass Totals extends Component {\r\n  render() {\r\n    const d = this.props.data, totals = this.props.data['t']\r\n    return <table>\r\n      <thead><tr><th>Years</th>\r\n        {Object.keys(d.n).reverse().map(n => {\r\n          return <th colSpan={4} key={n}>{n}</th>\r\n        })}\r\n      </tr>\r\n        <tr><th>Year</th>\r\n          {Object.keys(d.n).reverse().map(n => {\r\n            return <React.Fragment key={n}><th>n</th><th>total</th><th>μ</th><th>μ+</th></React.Fragment>\r\n          })}\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {Object.keys(totals).map(y => {\r\n          let t = 0, n = 0\r\n          return <tr key={y}><td>{y}</td>\r\n            {Object.keys(d.n).reverse().map(c => {\r\n              if (!totals[y][c]) return <React.Fragment key={c}><td></td><td></td><td></td><td></td></React.Fragment>\r\n              const dt = totals[y][c].t, dn = totals[y][c].n\r\n              t += dt\r\n              n += dn\r\n              return <React.Fragment key={c}><td>{Math.round(dn)}</td><td>{Math.round(dt)}</td><td>{Math.round(dt / dn)}</td><td>{Math.round(t / n)}</td></React.Fragment>\r\n            })}</tr>\r\n        })}\r\n      </tbody>\r\n    </table>\r\n  }\r\n}\r\n*/\r\n\r\nclass Select extends Component {\r\n  set = (e) => {\r\n    e.preventDefault()\r\n    this.props.set(e.target.value)\r\n  }\r\n  render() {\r\n    let options = [<option key={''} value=''>{this.props.name}</option>]\r\n    this.props.ks.forEach(e => { options.push(<option key={e}>{e}</option>) })\r\n    return <span>\r\n      <select value={this.props.k || ''} onChange={this.set}>{options}</select>\r\n    </span>\r\n  }\r\n}\r\n\r\nexport { Emma }","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport {Emma} from './Emma';\r\nimport './index.css'\r\n\r\nReactDOM.render(\r\n  <Emma />,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}